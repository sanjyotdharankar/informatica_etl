<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE POWERMART SYSTEM "powrmart.dtd">
<POWERMART CREATION_DATE="04/20/2025 15:00:00" REPOSITORY_VERSION="187.96">
  <REPOSITORY NAME="SampleRepo" VERSION="187" CODEPAGE="Latin1" DATABASETYPE="SQLServer">
    <FOLDER NAME="AccountProcessing" OWNER="Administrator" SHARED="NOTSHARED">

      <!-- Source Definition -->
      <SOURCE NAME="ACCOUNT" DATABASETYPE="SQL Server">
        <SOURCEFIELD NAME="ID" DATATYPE="integer" PRECISION="10" SCALE="0"/>
        <SOURCEFIELD NAME="NAME" DATATYPE="varchar" PRECISION="100" SCALE="0"/>
        <SOURCEFIELD NAME="PERSONAL" DATATYPE="varchar" PRECISION="255" SCALE="0"/>
        <SOURCEFIELD NAME="LASTMODIFIED_DATE" DATATYPE="datetime" PRECISION="19" SCALE="0"/>
      </SOURCE>

      <!-- Target Definition -->
      <TARGET NAME="DB_ACCOUNT" DATABASETYPE="SQL Server">
        <TARGETFIELD NAME="ID" DATATYPE="integer" PRECISION="10" SCALE="0"/>
        <TARGETFIELD NAME="NAME" DATATYPE="varchar" PRECISION="100" SCALE="0"/>
        <TARGETFIELD NAME="PERSONAL" DATATYPE="varchar" PRECISION="255" SCALE="0"/>
        <TARGETFIELD NAME="LASTMODIFIED_DATE" DATATYPE="datetime" PRECISION="19" SCALE="0"/>
      </TARGET>

      <!-- Mapping -->
      <MAPPING NAME="m_Load_Latest_Account">

        <!-- Source Qualifier -->
        <TRANSFORMATION NAME="SQ_ACCOUNT" TYPE="Source Qualifier">
          <TRANSFORMFIELD NAME="ID" PORTTYPE="INPUT/OUTPUT" DATATYPE="integer" PRECISION="10"/>
          <TRANSFORMFIELD NAME="NAME" PORTTYPE="INPUT/OUTPUT" DATATYPE="varchar" PRECISION="100"/>
          <TRANSFORMFIELD NAME="PERSONAL" PORTTYPE="INPUT/OUTPUT" DATATYPE="varchar" PRECISION="255"/>
          <TRANSFORMFIELD NAME="LASTMODIFIED_DATE" PORTTYPE="INPUT/OUTPUT" DATATYPE="datetime" PRECISION="19"/>
        </TRANSFORMATION>

        <!-- Lookup Transformation -->
        <TRANSFORMATION NAME="LKP_MAX_DATE" TYPE="Lookup Procedure">
          <TRANSFORMFIELD NAME="MAX_DATE" PORTTYPE="LOOKUP/OUTPUT" DATATYPE="datetime" PRECISION="19"/>
          <TABLEATTRIBUTE NAME="Lookup Sql Override" VALUE="SELECT MAX(LASTMODIFIED_DATE) AS MAX_DATE FROM ACCOUNT"/>
          <TABLEATTRIBUTE NAME="Lookup table name" VALUE="ACCOUNT"/>
        </TRANSFORMATION>

        <!-- Expression Transformation -->
        <TRANSFORMATION NAME="EXP_COMPARE_DATE" TYPE="Expression">
          <TRANSFORMFIELD NAME="LASTMODIFIED_DATE" PORTTYPE="INPUT" DATATYPE="datetime"/>
          <TRANSFORMFIELD NAME="MAX_DATE" PORTTYPE="INPUT" DATATYPE="datetime"/>
          <TRANSFORMFIELD NAME="o_IS_LATEST" PORTTYPE="OUTPUT" DATATYPE="integer" EXPRESSION="IIF(LASTMODIFIED_DATE = MAX_DATE, 1, 0)"/>
        </TRANSFORMATION>

        <!-- Router Transformation -->
        <TRANSFORMATION NAME="RTR_LATEST_RECORD" TYPE="Router">
          <TRANSFORMFIELD NAME="ID" PORTTYPE="INPUT" DATATYPE="integer"/>
          <TRANSFORMFIELD NAME="NAME" PORTTYPE="INPUT" DATATYPE="varchar" PRECISION="100"/>
          <TRANSFORMFIELD NAME="PERSONAL" PORTTYPE="INPUT" DATATYPE="varchar" PRECISION="255"/>
          <TRANSFORMFIELD NAME="LASTMODIFIED_DATE" PORTTYPE="INPUT" DATATYPE="datetime"/>
          <TRANSFORMFIELD NAME="o_IS_LATEST" PORTTYPE="INPUT" DATATYPE="integer"/>
          <GROUP NAME="LATEST" CONDITION="o_IS_LATEST = 1"/>
        </TRANSFORMATION>

        <!-- Instances -->
        <INSTANCE NAME="ACCOUNT" TRANSFORMATION_NAME="ACCOUNT" TRANSFORMATION_TYPE="Source Definition" TYPE="SOURCE"/>
        <INSTANCE NAME="DB_ACCOUNT" TRANSFORMATION_NAME="DB_ACCOUNT" TRANSFORMATION_TYPE="Target Definition" TYPE="TARGET"/>
        <INSTANCE NAME="SQ_ACCOUNT" TRANSFORMATION_NAME="SQ_ACCOUNT" TRANSFORMATION_TYPE="Source Qualifier" TYPE="TRANSFORMATION">
          <ASSOCIATED_SOURCE_INSTANCE NAME="ACCOUNT"/>
        </INSTANCE>
        <INSTANCE NAME="LKP_MAX_DATE" TRANSFORMATION_NAME="LKP_MAX_DATE" TRANSFORMATION_TYPE="Lookup Procedure" TYPE="TRANSFORMATION"/>
        <INSTANCE NAME="EXP_COMPARE_DATE" TRANSFORMATION_NAME="EXP_COMPARE_DATE" TRANSFORMATION_TYPE="Expression" TYPE="TRANSFORMATION"/>
        <INSTANCE NAME="RTR_LATEST_RECORD" TRANSFORMATION_NAME="RTR_LATEST_RECORD" TRANSFORMATION_TYPE="Router" TYPE="TRANSFORMATION"/>

        <!-- Connectors -->
        <CONNECTOR FROMFIELD="ID" FROMINSTANCE="SQ_ACCOUNT" TOFIELD="ID" TOINSTANCE="RTR_LATEST_RECORD"/>
        <CONNECTOR FROMFIELD="NAME" FROMINSTANCE="SQ_ACCOUNT" TOFIELD="NAME" TOINSTANCE="RTR_LATEST_RECORD"/>
        <CONNECTOR FROMFIELD="PERSONAL" FROMINSTANCE="SQ_ACCOUNT" TOFIELD="PERSONAL" TOINSTANCE="RTR_LATEST_RECORD"/>
        <CONNECTOR FROMFIELD="LASTMODIFIED_DATE" FROMINSTANCE="SQ_ACCOUNT" TOFIELD="LASTMODIFIED_DATE" TOINSTANCE="EXP_COMPARE_DATE"/>
        <CONNECTOR FROMFIELD="MAX_DATE" FROMINSTANCE="LKP_MAX_DATE" TOFIELD="MAX_DATE" TOINSTANCE="EXP_COMPARE_DATE"/>
        <CONNECTOR FROMFIELD="LASTMODIFIED_DATE" FROMINSTANCE="SQ_ACCOUNT" TOFIELD="LASTMODIFIED_DATE" TOINSTANCE="EXP_COMPARE_DATE"/>
        <CONNECTOR FROMFIELD="o_IS_LATEST" FROMINSTANCE="EXP_COMPARE_DATE" TOFIELD="o_IS_LATEST" TOINSTANCE="RTR_LATEST_RECORD"/>

        <!-- Route to Target -->
        <CONNECTOR FROMFIELD="ID" FROMINSTANCE="RTR_LATEST_RECORD" TOFIELD="ID" TOINSTANCE="DB_ACCOUNT"/>
        <CONNECTOR FROMFIELD="NAME" FROMINSTANCE="RTR_LATEST_RECORD" TOFIELD="NAME" TOINSTANCE="DB_ACCOUNT"/>
        <CONNECTOR FROMFIELD="PERSONAL" FROMINSTANCE="RTR_LATEST_RECORD" TOFIELD="PERSONAL" TOINSTANCE="DB_ACCOUNT"/>
        <CONNECTOR FROMFIELD="LASTMODIFIED_DATE" FROMINSTANCE="RTR_LATEST_RECORD" TOFIELD="LASTMODIFIED_DATE" TOINSTANCE="DB_ACCOUNT"/>

      </MAPPING>
    </FOLDER>
  </REPOSITORY>
</POWERMART>
